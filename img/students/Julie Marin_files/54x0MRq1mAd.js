if (self.CavalryLogger) { CavalryLogger.start_js(["cqXIN"]); }

__d('NotificationBeeper.react',['cx','Arbiter','ChannelConstants','NotificationBeeperConst','NotificationBeeperItem.react','NotificationBeeperPinnedPostLoader','NotificationConstants','NotificationImpressions','NotificationPhotoThumbnail','NotificationSound','NotificationUpdates','NotificationURI','NotificationUserActions','React','setTimeoutAcrossTransitions','shield'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('NotificationBeeperConst').ACTIVE_DELAY_LONG,j=c('NotificationBeeperConst').BeepStates,k=c('NotificationBeeperConst').FADE_OUT_LENGTH,l=c('NotificationBeeperConst').IDLE_DELAY,m=c('NotificationBeeperPinnedPostLoader').payload,n='beeper',o=c('NotificationConstants').PayloadSourceType,p=o.LIVE_SEND,q=o.OTHER_APPLICATION,r=o.CLIENT,s=c('React').createClass({displayName:'NotificationBeeper',getInitialState:function(){return {soundEnabled:this.props.soundEnabled,hovering:false,fading:false,beeps:{}};},componentWillMount:function(){this.subscriptions=[c('NotificationUpdates').subscribe('update-notifications',function(t,u){if(u.payloadsource===p||u.payloadsource===q||u.payloadsource===r){var v=u.nodes;if(v&&v.length)this._handleBeepChanges(this._convertNotifications(v));}if(u.payloadsource===r)this._handleBeepRemovals(u.hiddenState||{});}.bind(this)),c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('notif_sound_pref_changed'),function(t,u){this.setState({soundEnabled:u.obj.enabled});}.bind(this))];c('Arbiter').inform('NotificationBeeper/mounted',null,c('Arbiter').BEHAVIOR_PERSISTENT);if(m)this._handleBeepChanges(this._convertNotifications(m.nodes));},componentWillUnmount:function(){this.subscriptions.forEach(function(t){t.unsubscribe();});this.subscriptions=null;},_onMouseEnter:function(){this._hideWait&&clearTimeout(this._hideWait);var t=[],u=this.state.beeps;Object.keys(u).forEach(function(v){if(u[v].state!=j.PENDING){t.push(v);}else u[v].state=j.RENDERED;});c('NotificationUserActions').markNotificationsAsSeen(t);this.setState({hovering:true,fading:false,beeps:u});},_onMouseLeave:function(){this._waitToHide(i);this.setState({hovering:false});},_onInsertedItem:function(t){if(!this.state.hovering)this._waitToHide();if(this.state.soundEnabled&&t.sound){if(!this._notifSound)this._notifSound=new (c('NotificationSound'))(this.props.soundPath);this._notifSound.play(t.beepID);}if(this.props.shouldLogImpressions)c('NotificationImpressions').log([t.notificationID],n);},_waitToHide:function(t){this._hideWait&&clearTimeout(this._hideWait);this._hideWait=c('setTimeoutAcrossTransitions')(c('shield')(this._hide,this),t==null?l:t);},_onReadyToHide:function(t,u){this.state.beeps[t].state=j.READY_TO_HIDE;if(!this._hideWait)this._waitToHide(u);},_onPreventHide:function(t){this.state.beeps[t].state=j.RENDERED;},_hide:function(){this._hideWait=null;var t=this.state.beeps;Object.keys(t).forEach(function(u){if(t[u].state==j.READY_TO_HIDE)t[u].state=j.FADING_OUT;});this.setState({fading:true});c('setTimeoutAcrossTransitions')(c('shield')(this._finishHide,this),k);},_finishHide:function(){if(!this.state.fading)return;var t=this.state.beeps;Object.keys(t).forEach(function(u){if(t[u].state==j.FADING_OUT)delete t[u];});this.setState({fading:false,beeps:t});c('setTimeoutAcrossTransitions')(function(){var u=this.state.beeps;Object.keys(u).forEach(function(v){if(u[v].state==j.PENDING)u[v].state=j.RENDERED;});this.setState({beeps:u});}.bind(this));},_handleBeepChanges:function(t){var u=this.state.fading?j.PENDING:j.RENDERED,v=this.state.beeps,w=false;Object.keys(t).reverse().forEach(function(x){var y={state:u,data:t[x]};if(!v[x]||v[x].data.beepID!=y.data.beepID){if(v[x]){w=true;if(y.data.beepUpdatesOnTop)delete v[x];}v[x]=y;}});if(w)this._waitToHide();this.forceUpdate();},_handleBeepRemovals:function(t){var u=this.state.beeps;Object.keys(t).forEach(function(v){if(u[v])u[v].state=j.READY_TO_HIDE;});this._waitToHide(0);this.forceUpdate();},render:function(){var t=this.state.beeps,u=[];Object.keys(t).reverse().forEach(function(x){var y=t[x];if(y.state==j.PENDING)return;u.push(c('React').createElement(c('NotificationBeeperItem.react'),{key:x,fadingOut:this.state.fading&&y.state==j.FADING_OUT,beep:y.data,onInserted:this._onInsertedItem,onReadyToHide:this._onReadyToHide,onPreventHide:this._onPreventHide}));},this);var v=u.length>0,w=(!v?"hidden_elem":'')+(' '+"_50d1");return (c('React').createElement('ul',{ref:'container',className:w,'data-gt':this.props.tracking,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave},u));},_convertNotifications:function(t){var u={};t.forEach(function(v){if(!v.showBeep||!v.alert_id)return;var w=v.alert_id,x=w+'-'+v.receivedTime,y=c('NotificationPhotoThumbnail').getThumbnail(v.attachments,v.attached_story);u[w]={notificationID:w,notifID:v.id,beepID:x,beepRenderer:v.beepRenderer,rendererData:v.rendererData,beepUpdatesOnTop:v.beepUpdatesOnTop,actors:v.unaggregatedActors||v.actors,icon:v.icon,link:v.url?c('NotificationURI').localize(v.url):'#',url:v.url,ajaxifyLink:v.ajaxify_url,photo:y,text:v.unaggregatedTitle||v.title,timestamp:v.timestamp,receivedTime:v.receivedTime,sound:!!v.sound,tracking:v.tracking};});return u;}});f.exports=s;},null);